# This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Regenerate package-lock.json

on:
  workflow_call:
  workflow_dispatch:

jobs:
  regenerate-package-lock:
    name: Regenerate package-lock.json
    runs-on: ubuntu-latest

    steps:
      - name: Checkout the source
        uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b

      - name: Set up git branch
        run: |
          set -e
          git config user.name github-actions
          git config user.email github-actions@github.com
          git config push.default current
          git checkout -b "regenerate-bot/$(TZ=UTC date +%Y%m%dT%H%M%S%z)"

      - name: Setup Node.js
        uses: actions/setup-node@2fddd8803e2f5c9604345a0b591c3020ee971a93
        with:
          node-version: 18
          cache: npm

      - name: Enable corepack
        run: corepack enable npm && npm --version

      - name: Regenerate package-lock.json
        run: rm package-lock.json && npm install

      - name: Git Push
        run: |
          set -e
          git add --all
          git commit -m "chore: update dependencies by regenerating package-lock.json"
          git push
